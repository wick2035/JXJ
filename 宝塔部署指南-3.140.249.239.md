# 宝塔面板部署指南 - 3.140.249.239:9898

## 🎯 部署目标
- **服务器**: 3.140.249.239
- **端口**: 9898
- **部署路径**: /www/wwwroot/3.140.249.239_9898
- **访问地址**: http://3.140.249.239:9898/

## 📋 部署步骤

### 1. 宝塔面板操作

#### 步骤一：创建网站
1. 登录宝塔面板
2. 点击 "网站" → "添加站点"
3. 填写站点信息：
   ```
   域名: 3.140.249.239:9898
   根目录: /www/wwwroot/3.140.249.239_9898
   PHP版本: 7.4 或以上
   数据库: MySQL
   ```

#### 步骤二：上传项目文件
1. 将所有项目文件上传到 `/www/wwwroot/3.140.249.239_9898/`
2. 确保文件结构正确：
   ```
   /www/wwwroot/3.140.249.239_9898/
   ├── index.html (包含反注入脚本)
   ├── install.html
   ├── install.php
   ├── database.sql
   ├── api/
   │   ├── applications.php
   │   ├── auth.php
   │   ├── categories.php
   │   ├── announcements.php
   │   └── upload.php
   ├── assets/
   │   ├── css/style.css
   │   └── js/
   │       ├── main.js
   │       └── error-handler.js
   ├── uploads/ (权限777)
   └── logs/
   ```

#### 步骤三：配置Nginx
1. 网站 → 您的站点 → 设置 → 配置文件
2. 用 `nginx-config-3.140.249.239.conf` 的内容替换现有配置
3. 保存并重载nginx

### 2. 服务器端操作

#### 方法一：自动部署脚本
```bash
# 上传部署脚本到服务器
chmod +x deploy-3.140.249.239.sh
sudo ./deploy-3.140.249.239.sh
```

#### 方法二：手动配置
```bash
# 创建目录
mkdir -p /www/wwwroot/3.140.249.239_9898/{logs,uploads,api,assets/js,assets/css}

# 设置权限
chown -R www:www /www/wwwroot/3.140.249.239_9898/
chmod -R 755 /www/wwwroot/3.140.249.239_9898/
chmod -R 777 /www/wwwroot/3.140.249.239_9898/uploads/

# 检查nginx配置
nginx -t
sudo systemctl reload nginx
```

### 3. 必要的系统配置

#### 开放端口
```bash
# UFW防火墙
sudo ufw allow 9898

# 或者iptables
sudo iptables -A INPUT -p tcp --dport 9898 -j ACCEPT
```

#### 检查PHP扩展
在宝塔面板中确保以下PHP扩展已启用：
- ✅ mysqli
- ✅ json
- ✅ mbstring
- ✅ fileinfo
- ✅ gd2

#### 创建数据库
1. 宝塔面板 → 数据库 → 添加数据库
2. 数据库名：`scholarship_db`
3. 用户名：创建专用用户
4. 密码：设置强密码
5. 记录数据库连接信息

### 4. 测试访问

部署完成后，测试以下地址：

**✅ 主要测试点：**
- 🏠 主页：http://3.140.249.239:9898/
- 🔧 安装页面：http://3.140.249.239:9898/install
- 📡 API测试：http://3.140.249.239:9898/install.php?action=check_env
- 📁 静态资源：http://3.140.249.239:9898/assets/css/style.css

**✅ 功能测试：**
- 登录界面正常显示
- 安装向导正常工作
- 无第三方脚本注入错误
- 文件上传功能正常

### 5. 故障排除

#### 常见问题及解决方案

**问题：404错误**
```bash
# 检查nginx配置
nginx -t
# 检查文件是否存在
ls -la /www/wwwroot/3.140.249.239_9898/
# 查看nginx错误日志
tail -f /www/wwwroot/3.140.249.239_9898/logs/error.log
```

**问题：端口无法访问**
```bash
# 检查端口是否监听
netstat -tlnp | grep 9898
# 检查防火墙
sudo ufw status
# 检查云服务器安全组规则
```

**问题：PHP不执行**
```bash
# 检查PHP-FPM状态
systemctl status php7.4-fpm
# 检查PHP socket文件
ls -la /tmp/php-cgi-*.sock
```

**问题：数据库连接失败**
```bash
# 检查MySQL状态
systemctl status mysql
# 测试数据库连接
mysql -u用户名 -p数据库名
```

### 6. 安全建议

1. **防火墙配置**
   - 只开放必要端口
   - 限制SSH访问IP

2. **文件权限**
   - 网站文件644权限
   - 目录755权限
   - 上传目录777权限

3. **定期备份**
   - 数据库备份
   - 网站文件备份

4. **监控日志**
   - 定期检查访问日志
   - 监控错误日志

### 7. 性能优化

已在配置中包含：
- ✅ Gzip压缩
- ✅ 静态文件缓存
- ✅ 跨域支持
- ✅ 安全头设置

### 8. 完成检查清单

部署完成后，确认以下项目：

- [ ] 网站正常访问 (http://3.140.249.239:9898/)
- [ ] 安装页面正常 (http://3.140.249.239:9898/install)
- [ ] 数据库连接正常
- [ ] 文件上传功能正常
- [ ] 无第三方脚本注入
- [ ] 防火墙端口已开放
- [ ] SSL证书配置（如需要）
- [ ] 监控和备份设置

---

## 🎉 部署成功后的访问信息

- **系统主页**: http://3.140.249.239:9898/
- **安装向导**: http://3.140.249.239:9898/install
- **管理员登录**: admin/admin123 (安装完成后请修改)
- **学生登录**: student/student123 (安装完成后请修改)

## 📞 支持

如果在部署过程中遇到问题，请：
1. 检查nginx和PHP错误日志
2. 确认所有服务正常运行
3. 验证防火墙和安全组配置
4. 检查文件权限设置

祝您部署顺利！🚀 